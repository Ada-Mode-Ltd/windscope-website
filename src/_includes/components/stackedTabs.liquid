<h2 class="text-center">{{ sectionTitle }}</h2>

<div class="stacked-tabs" data-tabs="{{ tabs.size }}">
    {% for tab in tabs %}
    <div class="text" data-tab="{{ forloop.index0 }}" {% if forloop.first == true %} data-active {% endif %}>
        <p class="h5">{{ tab.title }}</p>
        <p>{{ tab.text }}</p>
    </div>
    <div class="image" data-tab="{{ forloop.index0 }}" {% if forloop.first == true %} data-active {% endif %}>
        <!-- <img src="{{ tab.image }}" alt=""> -->
        {% sanityImageUrl tab.image %}
    </div>
    {% endfor %}
</div>

<p>
    <a href="{{ sectionLink.url }}">{{ sectionLink.text }}</a>
</p>

<script>
    const stack = document.querySelector('.stacked-tabs');
    const tabs = stack.querySelectorAll('.text[data-tab]');
    const totalTabs = parseInt(stack.dataset.tabs);
    const images = stack.querySelectorAll('.image[data-tab]');

    // Loop through the tabs changing the active tab every 5000ms, or when a tab is clicked
    let activeTab = parseInt(stack.querySelector('.text[data-active]').dataset.tab);
    let intervalID = setInterval(() => {
        if (activeTab < totalTabs - 1) {
            activeTab++;
        } else {
            activeTab = 0;
        }
        changeTab(activeTab);
    }, 5000);

    tabs.forEach(tab => {
        tab.setAttribute('data-loop', '')
        tab.addEventListener('click', () => {
            clearInterval(intervalID);
            changeTab(tab.dataset.tab);
            intervalID = setInterval(() => {
                if (activeTab < totalTabs - 1) {
                    activeTab++;
                } else {
                    activeTab = 0;
                }
                changeTab(activeTab);
            }, 5000);
        });
    });

    function changeTab(tab) {
        tabs.forEach(tab => {
            tab.removeAttribute('data-active');
        });
        images.forEach(image => {
            image.removeAttribute('data-active');
        });
        tabs[tab].setAttribute('data-active', '');
        images[tab].setAttribute('data-active', '');
        activeTab = parseInt(tab);
    }
</script>